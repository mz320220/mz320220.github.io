---
title: 正则表达式
date: 2018-11-20 00:14:05
categories:
- 正则表达式
tags:
- 基础知识
---

![某一天的公司看去](http://martintop-image.oss-cn-shenzhen.aliyuncs.com/18-11-20/7400407.jpg)

Q：正则表达式是什么？

A：在编写处理字符串，经常会有查找符合某些复杂规则的字符串的需要。正则表达式就是用于描述这些规则的工具，也即记录文本规则的代码。例如：匹配符合规则的邮箱地址、手机号码等等。

<!--more-->

## 1.从例子开始

假设你在一篇英文小说里查找hi，你可以使用正则表达式hi。但是很多单词里包含hi这两个连续的字符，比如him,history,high等等。用hi来查找的话，这里边的hi也会被找出来。如果要精确地查找hi这个单词的话，我们应该使用`\bhi\b`

* `\b` 是正则表达式规定的一个特殊代码（元字符）,代表着单词的开头或结尾，也就是单词的分界处。通常英文的单词是由空格，标点符号或者换行来分隔的，但是\b并不匹配这些分隔字符，它**只匹配一个位置**。

假如你要找的是hi后面不远处跟着一个Lucy，应该用`\bhi\b.*\bLucy\b`

* `.`是另一个元字符，匹配除了换行符以外的任意字符。
* `*`也是元字符，它代表数量：*前边的内容可以连续重复使用任意次以使整个表达式得到匹配。

所以两者结合使用 **.***：代表任意数量的不包含换行的字符。



**`^[0-9]+abc$`**

* ^ 为匹配输入字符串的开始位置。
* [0-9]+匹配多个数字， [0-9] 匹配单个数字，+ 匹配一个或者多个。
* abc$匹配字母 abc 并以 abc 结尾，$ 为匹配输入字符串的结束位置。
* 可以匹配**1232xyzabc、32eabc**等。



**`^[a-z0-9_-]{3,15}$`**

* ^ 为匹配输入字符串的开始位置。
* [a-z0-9_-]匹配字母a-z、数字0-9、下划线、连字符。
* {3,15}匹配3-15个字符长度
* $结束标记
* 可以匹配 **runoob、runoob1、run-oob、run_oob**， 但不匹配 **ru**，因为它包含了小写的字母而且太短了，也不匹配 **runoob$**, 因为它包含特殊字符。

## 2.正则表达式的语法

### 2.1普通字符

普通字符也就是一般的字符类，包括没有显式指定为元字符的所有可打印和不可打印字符。这包括**所有大写和小写字母、所有数字、所有标点符号和一些其他符号** .举例如下：

* [aeiou]就匹配任何一个英文元音字母，[.?!]匹配标点符号(.或?或!)。
* [0-9]代表的含意与\d就是完全一致的：一位数字；(用来指定范围)
* `\(?0\d{2}[) -]?\d{8}`：这个复杂的表达式由几个部分组成，`\(`一个转义字符，可以出现`?`零次或一次；然后是一个数字`0`,后面跟着两个数字`\d{2}`;接下来是一个方括号表达式`[) -]?`表示括号、空格或连接符中的任何一个，出现零次或一次；最后为八个数字`\d{8}`。从以上分析可知，该正则表达式可以匹配：(010)88886666，或022-22334455，或02912345678等

### 2.2常用元字符

非打印字符也可以是正则表达式的组成部分。如下表所示：

| 字符  | 描述                                                         |
| ----- | ------------------------------------------------------------ |
| **.** | 匹配除换行符 \n 之外的任何单字符。要匹配 . ，请使用 `\.` 。  |
| \w    | 匹配**字母、数字、下划线**。等价于'[A-Za-z0-9_]'。           |
| \d    | 匹配一个**数字**字符。等价于 [0-9]。                         |
| \s    | 匹配任何**空白字符**，包括空格、制表符、换页符等等 Unicode 正则表达式会匹配全角空格符。 |
| \b    | 匹配一个**单词边界**，也就是指单词和空格间的位置。例如， 'er\b' 可以匹配"never" 中的 'er'，但不能匹配 "verb" 中的 'er'。 |
| ^     | 匹配输入字符串的**开始位置**。如果设置了 RegExp 对象的 Multiline 属性，^ 也匹配 '\n' 或 '\r' 之后的位置。 |
| $     | 匹配输入字符串的**结束位置**。如果设置了RegExp 对象的 Multiline 属性，$ 也匹配 '\n' 或 '\r' 之前的位置。 |

### 2.3特殊字符

所谓特殊字符，就是一些有特殊含义的字符，也就是一般所说的元字符。如上面例子中的`*`等。如果需要查找字符串中的元字符，则需要在字符前加`\`进行转义。

例如：`deerchao\.net匹配deerchao.net，C:\\Windows匹配C:\Windows`。

| 字符 | 描述                                                         |
| ---- | ------------------------------------------------------------ |
| ( )  | 标记一个子表达式的开始和结束位置。子表达式可以获取供以后使用。 |
| [    | 标记一个中括号表达式的开始。要匹配 [，请使用` \[`。          |
| \    | 将下一个字符标记为或特殊字符、或原义字符、或向后引用、或八进制转义符。例如，` 'n'` 匹配字符 'n'。`'\n'` 匹配换行符。序列 `'\\'` 匹配 `"\"`，而` '\('` 则匹配 `"("`。 |
| {    | 标记限定符表达式的开始。要匹配 {，请使用 `\{`。              |
| \|   | 指明两项之间的一个选择。要匹配 \|，请使用 `\|`。             |

### 2.4限定符 | 重复表示

限定符用来指定正则表达式的一个给定组件必须要出现多少次才能满足匹配。如下表：

| 字符  | 描述                                                         |
| ----- | ------------------------------------------------------------ |
| *     | 匹配前面的子表达式**零次或多次**。例如，zo* 能匹配 "z" 以及 "zoo"。* 等价于{0,}。 |
| +     | 匹配前面的子表达式**一次或多次**。例如，'zo+' 能匹配 "zo" 以及 "zoo"，但不能匹配 "z"。+ 等价于 {1,}。 |
| ?     | 匹配前面的子表达式**零次或一次**。例如，"do(es)?" 可以匹配 "do" 、 "does" 中的 "does" 、 "doxy" 中的 "do" 。? 等价于 {0,1}。 |
| {n}   | n 是一个非负整数。**匹配确定的 n 次**。例如，'o{2}' 不能匹配 "Bob" 中的 'o'，但是能匹配 "food" 中的两个 o。 |
| {n,}  | n 是一个非负整数。**至少**匹配n 次。例如，'o{2,}' 不能匹配 "Bob" 中的 'o'，但能匹配 "foooood" 中的所有 o。'o{1,}' 等价于 'o+'。'o{0,}' 则等价于 'o*'。 |
| {n,m} | m 和 n 均为非负整数，其中n <= m。**最少匹配 n 次且最多匹配 m 次**。例如，"o{1,3}" 将匹配 "fooooood" 中的前三个 o。'o{0,1}' 等价于 'o?'。请注意在逗号和两个数之间不能有空格。 |

### 2.5反义

有时需要查找不属于某个能简单定义的字符类的字符。比如想查找除了数字以外，其它任意字符都行的情况，这时需要用到反义：

| 字符     | 说明                                       |
| -------- | ------------------------------------------ |
| \W       | 匹配任意不是字母，数字，下划线，汉字的字符 |
| \S       | 匹配任意**不是空白符**的字符               |
| \D       | 匹配任意**非数字**的字符                   |
| \B       | 匹配**不是单词开头或结束**的位置           |
| [^x]     | 匹配**除了x以外**的任意字符                |
| [^aeiou] | 匹配除了aeiou这几个字母以外的任意字符      |

举例：

* `\S+`：匹配不包含空白字符的字符串
* `<a[^>]+>`：匹配用尖括号括起来的，以a开头的字符串。（方括号中表示不包含`>`）

### 2.6分支条件

分枝条件指的是有几种规则，如果满足其中任意一种规则都应该当成匹配。具体方法是使用`|`把不同的规则分开。举例如下：

* `0\d{2}-\d{8}|0\d{3}-\d{7}`：可以匹配到两种电话号码，如：012-23456433，或0233-3345329。

* `\(0\d{2}\)[- ]?\d{8}|0\d{2}[- ]?\d{8}`：可以匹配(023)-34553432,或023-84957362,且区号和本地号码间可以不存在连接符。

**TIPS：使用分支条件时，需要注意各个条件之间的顺序。**

* `\d{5}-\d{4}|\d{5}`：表示美国的邮政编码，5位数字或者使用连接符拼接的9位数字。然而当分支条件顺序调换：
* `\d{5}|\d{5}-\d{4}`：那么只能匹配到5位数字了，永远不会匹配到9位的编码，因为匹配顺序从左到右，满足了前面的分支后就不会再处理其他条件了。

### 2.7分组

我们已经提到了怎么重复单个字符（直接在字符后面加上限定符就行了）；但如果想要重复多个字符又该怎么办？可以用**小括号**来指定**子表达式(也叫做分组)**，然后指定这个子表达式的重复次数。举例：

`(\d{1,3}\.){3}\d{1,3}`：一个简单的IP地址匹配。`\d{1,3}\.`匹配三个数字加上一个英文句号，被括号括起来表示一个分组后面接上`{3}`表示这个分组重复三次，最后再加上一个三位的数字。不过以上的匹配没有限制IP地址不可以大于255，更进一步：

`((2[0-4]\d|25[0-5]|[01]?\d\d?)\.){3}(2[0-4]\d|25[0-5]|[01]?\d\d?)`

focus on:`2[0-4]\d|25[0-5]|[01]?\d\d?`



## 3.拓展学习

### 3.1运算符优先级

正则表达式从左到右进行计算，并遵循优先级顺序，这与算术表达式非常类似。

相同优先级的从左到右进行运算，不同优先级的运算先高后低。如下表所示：

| 运算符                      | 描述                                                         |
| --------------------------- | ------------------------------------------------------------ |
| \                           | 转义符                                                       |
| `(), (?:), (?=), []`        | 圆括号和方括号                                               |
| *, +, ?, {n}, {n,}, {n,m}   | 限定符                                                       |
| ^, $, \任何元字符、任何字符 | 定位点和序列（即：位置和顺序）                               |
| \|                          | 替换，"或"操作 字符具有高于替换运算符的优先级，使得"m\|food"匹配"m"或"food"。若要匹配"mood"或"food"，请使用括号创建子表达式，从而产生"(m\|f)ood"。 |

### 3.2匹配规则

#### 3.2.1基本模式匹配

模式，是正则表达式最基本的元素，它们是一组描述字符串特征的字符。模式可以很简单，由普通的字符串组成，也可以非常复杂，往往用特殊的字符表示一个范围内的字符、重复出现，或表示上下文。例如：

```
^once
```

这个模式包含一个特殊的字符^，表示该模式只匹配那些以once开头的字符串。例如该模式与字符串"once upon a time"匹配，与"There once was a man from NewYork"不匹配。正如如^符号表示开头一样，$符号用来匹配那些以给定模式结尾的字符串。

```
bucket$
```

这个模式与"Who kept all of this cash in a bucket"匹配，与"buckets"不匹配。字符^和$同时使用时，表示精确匹配（字符串与模式一样）。例如：

```
^bucket$
```

只匹配字符串"bucket"。如果一个模式不包括^和$，那么它与任何包含该模式的字符串匹配。例如：模式

```
once
```

与字符串

```
There once was a man from NewYork
Who kept all of his cash in a bucket.
```

是匹配的。

在该模式中的字母(o-n-c-e)是字面的字符，也就是说，他们表示该字母本身，数字也是一样的。其他一些稍微复杂的字符，如标点符号和白字符（空格、制表符等），要用到转义序列。所有的转义序列都用反斜杠(\)打头。制表符的转义序列是：\t。所以如果我们要检测一个字符串是否以制表符开头，可以用这个模式：

```
^\t 
```

类似的，用\n表示"新行"，\r表示回车。其他的特殊符号，可以用在前面加上反斜杠，如反斜杠本身用\\表示，句号.用\.表示，以此类推。

#### 3.2.2字符簇

在INTERNET的程序中，正则表达式通常用来验证用户的输入。当用户提交一个FORM以后，要判断输入的电话号码、地址、EMAIL地址、信用卡号码等是否有效，用普通的基于字面的字符是不够的。所以要用一种更自由的描述我们要的模式的办法，它就是字符簇。

下面这个例子与任何元音字符匹配，但只能表示一个字符：

```
[AaEeIiOoUu]
```

用连字号可以表示一个字符的范围，如：

```
[a-z] //匹配所有的小写字母 
[A-Z] //匹配所有的大写字母 
[a-zA-Z] //匹配所有的字母 
[0-9] //匹配所有的数字 
[0-9\.\-] //匹配所有的数字，句号和减号 
[ \f\r\t\n] //匹配所有的白字符
```

同样的，**这些也只表示一个字符**。如果要匹配一个由一个小写字母和一位数字组成的字符串，比如"z2"、"t6"或"g7"，但不是"ab2"、"r2d3" 或"b52"的话，用这个模式：

```
^[a-z][0-9]$
```

尽管[a-z]代表26个字母的范围，但在这里它只能与第一个字符是小写字母的字符串匹配。

前面曾经提到`^`表示字符串的开头，但它还有另外一个含义。**当在一组方括号里使用^，它表示"非"或"排除"**的意思，常常用来剔除某个字符。前面的例子中，如果我们要求第一个字符不能是数字：

```
^[^0-9][0-9]$
```

这个模式与"&5"、"g7"及"-2"是匹配的，但与"12"、"66"是不匹配的。下面是几个排除特定字符的例子：

```
[^a-z] //除了小写字母以外的所有字符 
[^\\\/\^] //除了(\)(/)(^)之外的所有字符 
[^\"\'] //除了双引号(")和单引号(')之外的所有字符
```

特殊字符"." (点，句号)在正则表达式中用来表示除了"新行"之外的所有字符。所以模式"^.5$"与任何两个字符的、以数字5结尾和以其他非"新行"字符开头的字符串匹配。模式"."可以匹配任何字符串，除了空串和只包括一个"新行"的字符串。

#### 3.2.3确定重复出现

以上两种匹配已经可以解决很多问题，但某些情况下，可能要匹配一个单词或一组数字。一个单词有若干个字母组成，一组数字有若干个单数组成。跟在字符或字符簇后面的花括号({})用来确定前面的内容的重复出现的次数。

| 字符簇             | 描述                            |
| ------------------ | ------------------------------- |
| `^[a-zA-Z_]$`      | 所有的字母和下划线              |
| `^[[:alpha:]]{3}$` | 所有的3个字母的单词             |
| ^a$                | 字母a                           |
| ^a{4}$             | aaaa                            |
| ^a{2,4}$           | aa,aaa或aaaa                    |
| ^a{1,3}$           | a,aa或aaa                       |
| ^a{2,}$            | 包含多于两个a的字符串           |
| ^a{2,}             | 如：aardvark和aaab，但apple不行 |
| a{2,}              | 如：baad和aaa，但Nantucket不行  |
| \t{2}              | 两个制表符                      |
| .{2}               | 所有的两个字符                  |

这些例子描述了花括号的三种不同的用法。一个数字 {x} 的意思是**前面的字符或字符簇只出现x次** ；一个数字加逗号 {x,} 的意思是**前面的内容出现x或更多的次数** ；两个数字用逗号分隔的数字 {x,y} 表示 **前面的内容至少出现x次，但不超过y次**。我们可以把模式扩展到更多的单词或数字：

```
^[a-zA-Z0-9_]{1,}$      // 所有包含一个以上的字母、数字或下划线的字符串 
^[1-9][0-9]{0,}$        // 所有的正整数 
^\-{0,1}[0-9]{1,}$      // 所有的整数 
^[-]?[0-9]+\.?[0-9]+$   // 所有的浮点数
```

特殊字符 ? 与 {0,1} 是相等的，它们都代表着： **0个或1个前面的内容** 或 **前面的内容是可选的** 。

特殊字符 * 与 {0,} 是相等的，它们都代表着 **0 个或多个前面的内容** 。

特殊字符 + 与 {1,} 是相等的，表示 **1 个或多个前面的内容** ，所以上面的4个例子可以写成：

```
^[a-zA-Z0-9_]+$      // 所有包含一个以上的字母、数字或下划线的字符串 
^[1-9][0-9]*$        // 所有的正整数 
^\-?[0-9]+$          // 所有的整数 
^[-]?[0-9]+(\.[0-9]+)?$ // 所有的浮点数
```

### 3.3 java中的正则表达式

在其他语言中，`\\ `表示：**我想要在正则表达式中插入一个普通的（字面上的）反斜杠，没有任何特殊的意义。**

在 Java 中，`\\` 表示：**我要插入一个正则表达式的反斜线，所以其后的字符具有特殊的意义。**

所以，在其他的语言中（如Perl），一个反斜杠 \ 就足以具有转义的作用，而在 Java 中正则表达式中则需要有两个反斜杠才能被解析为其他语言中的转义作用。也可以简单的理解在 Java 的正则表达式中，两个 `\\` 代表其他语言中的一个 \，所以在Java语言中**表示一位数字的正则表达式是 `\\d`，而表示一个普通的反斜杠是 `\\\\`**。

#### 3.4 高级语法

一些不太常用的不再详细列举，参考文末的正则表达式30分钟入门。

* 后向引用
* 零宽断言 & 负向零宽断言
* 贪婪与懒惰

## 4.元字符集合

正则表达式的完整元字符整理参考下方链接：

[正则表达式元字符](http://www.runoob.com/regexp/regexp-metachar.html)



> 本文参考文章：
>
> [正则表达四30分钟入门](https://deerchao.net/tutorials/regex/regex.htm#mission)
>
> [菜鸟正则表达式教程](http://www.runoob.com/regexp/regexp-tutorial.html)